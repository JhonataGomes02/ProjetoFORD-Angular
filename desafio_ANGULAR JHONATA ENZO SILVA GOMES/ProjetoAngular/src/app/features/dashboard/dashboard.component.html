<div class="dashboard-dark-container">

  <div class="container-fluid p-3">

    <div class="dashboard-header">
      <h2 class="mb-0 text-center ford-blue-text">Dashboard FORD</h2>
  
      <div class="profile-dropdown">
        <button class="profile-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
          </svg>
          admin
        </button>
        <div class="dropdown-content">
          <a routerLink="/home">Voltar para Home</a>
          <a href="#" (click)="logout($event)">Logout</a>
        </div>
      </div>
    </div>
   
    <div *ngIf="allVehicles$ | async as vehicles">
      <div class="row">
        
        <div class="col-md-3">
          <div class="card glass-card h-100">
            <div class="card-body">
              <h5 class="card-title text-white">Veículo</h5>
              <label for="vehicleSelect" class="form-label text-white-50">Selecione o Modelo:</label>
              <select id="vehicleSelect" class="form-select form-control-glass" [formControl]="modelSearchControl">
                <option value="">-- Selecione --</option>
                <option *ngFor="let v of vehicles" [value]="v.vehicle" class="text-black">
                  {{ v.vehicle }}
                </option>
              </select>
            </div>
          </div>
        </div>
  
        <ng-container *ngIf="selectedVehicle$ | async as vehicle; else noVehicleSelected">
          <div class="col-md-3">
            <div class="card glass-card card-stat h-100">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="stat-icon me-3">
                    <i class="bi bi-cash-stack"></i> </div>
                  <div class="stat-info">
                    <h6 class="card-subtitle mb-1 text-white-50">Total de Vendas</h6>
                    <h2 class="card-text text-white mb-0">{{ vehicle.volumetotal | number }}</h2>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card glass-card card-stat h-100">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="stat-icon me-3">
                    <i class="bi bi-car-front"></i> </div>
                  <div class="stat-info">
                    <h6 class="card-subtitle mb-1 text-white-50">Veículos Conectados</h6>
                    <h2 class="card-text text-white mb-0">{{ vehicle.connected | number }}</h2>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card glass-card card-stat h-100">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="stat-icon me-3">
                    <i class="bi bi-cpu"></i> </div>
                  <div class="stat-info">
                    <h6 class="card-subtitle mb-1 text-white-50">Software Atualizado</h6>
                    <h2 class="card-text text-white mb-0">{{ vehicle.softwareUpdates | number }}</h2>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
  
        <ng-template #noVehicleSelected>
          <div class="col-md-9">
            <div class="alert alert-info-glass h-100 d-flex align-items-center justify-content-center">
               Selecione um modelo de veículo para ver os dados.
            </div>
          </div>
        </ng-template>
      </div>
  
      <div *ngIf="selectedVehicle$ | async as vehicle" class="row my-4 justify-content-center">
        <div class="col-md-8 text-center">
          <div class="card glass-card shadow-sm border-0 p-3">
            <img [src]="vehicle.img" [alt]="vehicle.vehicle" class="img-fluid rounded" style="max-height: 400px;">
          </div>
        </div>
      </div>
  
      <div class="row mt-4">
        <div class="col-12">
          
          <div class="card glass-card mb-3">
            <div class="card-body">
              <label for="vinSearch" class="form-label fw-bold text-white">Buscar por Código do Veículo (VIN):</label>
              <input type="text" 
                class="form-control form-control-glass" 
                id="vinSearch" 
                [formControl]="vinSearchControl"
                placeholder="Ex: 2FRHDUYS2Y63NHD22454">
            </div>
          </div>
  
          <div *ngIf="vinError$ | async as error" class="alert alert-danger-glass">
            {{ error }}
          </div>
          
          <div *ngIf="vehicleData$ | async as data" class="table-responsive">
            <table class="table table-dark table-striped table-hover" style="--bs-table-bg: transparent; backdrop-filter: blur(5px);">
              <thead class="thead-ford-blue">
                <tr>
                  <th>Odômetro</th>
                  <th>Nível de Combustível</th>
                  <th>Status</th>
                  <th>Latitude</th>
                  <th>Longitude</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ data.odometro | number }} km</td>
                  <td>{{ data.nivelCombustivel }}%</td>
                  <td>{{ data.status }}</td>
                  <td>{{ data.lat }}</td>
                  <td>{{ data.long }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
  
    </div> 
  </div> </div>