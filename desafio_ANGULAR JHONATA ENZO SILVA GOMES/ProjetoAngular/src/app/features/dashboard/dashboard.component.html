<div class="container-fluid p-3">
  
  <div class="dashboard-header">
    <h2 class="mb-0">Dashboard FORD</h2>

    <div class="profile-dropdown">
      <button class="profile-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
          <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
          <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
        </svg>
        admin
      </button>
      <div class="dropdown-content">
        <a routerLink="/home">Voltar para Home</a>
        <a href="#" (click)="logout($event)">Logout</a>
      </div>
    </div>
  </div>
 
  <div *ngIf="allVehicles$ | async as vehicles">
    <div class="row">
      
      <div class="col-md-3">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">Veículo</h5>
            <label for="vehicleSelect" class="form-label">Selecione o Modelo:</label>
            <select id="vehicleSelect" class="form-select" [formControl]="modelSearchControl">
              <option value="">-- Selecione --</option>
              <option *ngFor="let v of vehicles" [value]="v.vehicle">
                {{ v.vehicle }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <ng-container *ngIf="selectedVehicle$ | async as vehicle; else noVehicleSelected">
        <div class="col-md-3">
          <div class="card h-100 text-center">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Total de Vendas</h6>
              <h2 class="card-text">{{ vehicle.volumetotal | number }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card h-100 text-center">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Veículos Conectados</h6>
              <h2 class="card-text">{{ vehicle.connected | number }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card h-100 text-center">
            <div class="card-body">
              <h6 class="card-subtitle mb-2 text-muted">Software Atualizado</h6>
              <h2 class="card-text">{{ vehicle.softwareUpdates | number }}</h2>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #noVehicleSelected>
        <div class="col-md-9">
          <div class="alert alert-info h-100 d-flex align-items-center justify-content-center">
             Selecione um modelo de veículo para ver os dados.
          </div>
        </div>
      </ng-template>
    </div>

    <div *ngIf="selectedVehicle$ | async as vehicle" class="row my-4 justify-content-center">
      <div class="col-md-8 text-center">
        <img [src]="vehicle.img" [alt]="vehicle.vehicle" class="img-fluid" style="max-height: 400px;">
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-12">
        
        <div class="card mb-3">
          <div class="card-body">
            <label for="vinSearch" class="form-label fw-bold">Buscar por Código do Veículo (VIN):</label>
            <input type="text" 
              class="form-control" 
              id="vinSearch" 
              [formControl]="vinSearchControl"
              placeholder="Ex: 2FRHDUYS2Y63NHD22454">
          </div>
        </div>

        <div *ngIf="vinError$ | async as error" class="alert alert-warning">
          {{ error }}
        </div>
        
        <div *ngIf="vehicleData$ | async as data" class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th>Odômetro</th>
                <th>Nível de Combustível</th>
                <th>Status</th>
                <th>Latitude</th>
                <th>Longitude</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{ data.odometro | number }} km</td>
                <td>{{ data.nivelCombustivel }}%</td>
                <td>{{ data.status }}</td>
                <td>{{ data.lat }}</td>
                <td>{{ data.long }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div> </div>